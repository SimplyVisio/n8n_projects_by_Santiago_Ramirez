{
  "name": "cron para responder comentarios con DM privado+comentario FB",
  "nodes": [
    {
      "parameters": {
        "content": "Facebook Community Manager Agent (CRON)\n\nThis autonomous workflow monitors, classifies, and responds to Facebook comments relative to recent posts every 10 minutes.\n\nKey Capabilities:\n1. Automatic Polling: Fetches recent activity via Facebook Graph API.\n2. Hybrid Classification: Uses specialized JS rules and AI for intent detection.\n3. Dual Response Mode: Sends private DMs for leads and public comments for engagement.\n4. Brand Consistency: Appends a curated social footer to all responses.\n\nEngine:\nFacebook API + GPT-4o mini + Vector Knowledge Base",
        "height": 450,
        "width": 320,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2700,
        350
      ],
      "typeVersion": 1,
      "id": "doc-overview",
      "name": "Project Overview"
    },
    {
      "parameters": {
        "content": "Data Acquisition Layer\n\n- Schedule Trigger: Runs every 10 minutes to ensure near real-time response.\n- Access Management: Centralized node for Facebook Page tokens.\n- Graph API Integration: Sequentially fetches the last 10 posts and their respective comments.",
        "height": 380,
        "width": 280,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2150,
        350
      ],
      "typeVersion": 1,
      "id": "doc-data-acq",
      "name": "Data Acquisition Layer"
    },
    {
      "parameters": {
        "content": "Classification & Filtering Layer\n\n- Time Filter: Processes only comments created in the last 10 minutes (matching the CRON frequency).\n- Rule-Based Classifier: A specialized JS engine that categorizes comments into:\n  * DM+Comment: Clear sales/service interest.\n  * Comment: General social interaction/praise.\n  * Spam: Repetitive, too short, or irrelevant content.\n\nThis layer ensures that only high-quality engagement reaches the AI or the final action nodes.",
        "height": 420,
        "width": 300,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1050,
        150
      ],
      "typeVersion": 1,
      "id": "doc-filter",
      "name": "Classification Engine Layer"
    },
    {
      "parameters": {
        "content": "AI Intelligence Layer (GPT-4o mini)\n\nThe AI Agent re-evaluates comments to ensure perfect intent detection. It is equipped with a Vector Knowledge Base (search_knowledge_base tool) to retrieve accurate information about the brand's services.\n\nModes:\n- Sales Mode: Converts queries into leads with strong CTAs.\n- Community Mode: Human-like, warm interaction to build brand loyalty.",
        "height": 400,
        "width": 280,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        -150
      ],
      "typeVersion": 1,
      "id": "doc-ai",
      "name": "AI Intelligence Layer"
    },
    {
      "parameters": {
        "content": "Action & Formatting Layer\n\n- Message Finalizer: Appends social handles, contact info, and legal links to the AI output.\n- Distribution: Executes API calls to Facebook for:\n  * Private Message (DM) to open a direct sales loop.\n  * Public Comment Thread reply to boost post visibility (Engagement).\n- Sequential Handling: Waits between messages to remain within Facebook's safety limits.",
        "height": 420,
        "width": 300,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        250,
        150
      ],
      "typeVersion": 1,
      "id": "doc-actions",
      "name": "Action Execution Layer"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "545bdad2-a10b-44ca-a668-ed08e11f67b6",
              "name": "access_token",
              "value": "your_access_token",
              "type": "string"
            },
            {
              "id": "87eca430-9784-4cd8-ab22-0e9ae82820d1",
              "name": "page_id",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2144,
        592
      ],
      "id": "5825509c-0159-4645-9db3-fc5c56a14bda",
      "name": "access_token"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v24.0/{{ $json.id }}/comments?fields=id,message,from,created_time,like_count&order=reverse_chronological&access_token={{ $('access_token').item.json.access_token }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1472,
        592
      ],
      "id": "90c6950f-1834-4048-a04b-208bc69d5c64",
      "name": "GET Comentarios"
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v24.0/{{ $('access_token').item.json.page_id }}/feed?fields=id,message,created_time,attachments,permalink_url&limit=10&access_token={{ $('access_token').item.json.access_token }}&order=desc ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1920,
        592
      ],
      "id": "e53657b7-df9c-4acc-881f-252eb03d4cae",
      "name": "GET Publicaciones"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1696,
        592
      ],
      "id": "93efc9da-9066-4fd5-af4b-5acbf63f3776",
      "name": "SEPARAR Publicaciones"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1248,
        592
      ],
      "id": "d41bab16-2a5e-45ac-9766-4d361e201d7a",
      "name": "SEPARAR Comentarios"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -2368,
        592
      ],
      "id": "b4dc6943-1722-40f7-9b75-a219392442fb",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fb1b3f9a-8138-4c02-b17c-87c431a87e27",
              "leftValue": "={{ $json.created_time }}",
              "rightValue": "={{ new Date(Date.now() - 600000 + (new Date().getTimezoneOffset() * -60000)).toISOString().replace('Z', '+0000') }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "a10476e0-5bf4-4841-97b5-62a715dc6468",
              "leftValue": "={{ $json.from.name }}",
              "rightValue": "your_brand",
              "operator": {
                "type": "string",
                "operation": "notContains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -1024,
        592
      ],
      "id": "e9af4efe-b173-4008-9575-93412ba93107",
      "name": "Si ultimo 10 minutos + No Propio"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -288,
        64
      ],
      "id": "27ad6148-0da0-482b-b895-0f644f9427f2",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        448,
        64
      ],
      "id": "34737ff1-3a96-498b-b6ca-18c86c2f38b9",
      "name": "Wait1",
      "webhookId": "97dc9a2e-95f0-4961-899e-023e181d6e9e"
    },
    {
      "parameters": {
        "jsCode": "// Filtro de comentarios para Meta Ads - n8n Code Node\n// Determina: DM+comment, comment o spam (filtrar)\n// Versi√≥n corregida: ORDEN DE PRIORIDAD corregido\n\nconst results = [];\n\n// Iterar sobre todos los items de entrada\nfor (const item of $input.all()) {\n  const commentText = item.json.text;\n  \n  // Preservar todos los campos originales\n  const originalData = { ...item.json };\n\n  // Normalizar el texto: convertir a min√∫sculas y eliminar espacios extra\n  const normalizedText = commentText.toLowerCase().trim();\n\n  // ==================================================================\n  // CATEGOR√çA 1: SPAM (FILTRAR - NO RESPONDER)\n  // ==================================================================\n\n  // 1. Comentarios vac√≠os\n  if (normalizedText.length === 0) {\n    results.push({ json: { \n      ...originalData,\n      result: 'spam', \n      reason: 'Comentario vac√≠o',\n      category: 'empty',\n      action: 'No responder'\n    } });\n    continue;\n  }\n\n  // 2. Solo puntuaci√≥n o caracteres especiales\n  const spamPatterns = [\n    /^\\.+$/, // Solo puntos: ., .., ..., ....\n    /^,+$/, // Solo comas: ,, ,,, ....\n    /^!+$/, // Solo signos de exclamaci√≥n: !, !!, !!!\n    /^\\?+$/, // Solo signos de interrogaci√≥n: ?, ??, ???\n    /^[\\s\\.\\,\\!\\?\\-\\_\\+\\=\\*\\#\\$\\%\\&\\/\\(\\)]+$/, // Combinaciones de puntuaci√≥n y espacios\n  ];\n\n  // Detectar si el comentario son solo emojis (sin letras ni n√∫meros)\n  const hasOnlyEmojis = /^[\\p{Emoji}\\s]+$/u.test(normalizedText) && !/[a-z0-9]/i.test(normalizedText);\n\n  let isSpamPattern = false;\n  for (let pattern of spamPatterns) {\n    if (pattern.test(normalizedText)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'spam', \n        reason: 'Solo puntuaci√≥n sin texto',\n        category: 'punctuation_only',\n        action: 'No responder'\n      } });\n      isSpamPattern = true;\n      break;\n    }\n  }\n  if (isSpamPattern) continue;\n\n  // Verificar si son solo emojis\n  if (hasOnlyEmojis) {\n    results.push({ json: { \n      ...originalData,\n      result: 'spam', \n      reason: 'Solo emojis sin texto',\n      category: 'emoji_only',\n      action: 'No responder'\n    } });\n    continue;\n  }\n\n  // 3. Comentarios extremadamente cortos (1-2 caracteres)\n  if (normalizedText.length <= 2) {\n    results.push({ json: { \n      ...originalData,\n      result: 'spam', \n      reason: 'Comentario demasiado corto',\n      category: 'too_short',\n      action: 'No responder'\n    } });\n    continue;\n  }\n\n  // 4. Spam com√∫n en redes sociales\n  const commonSpam = [\n    'xd',\n    'jaja',\n    'jajaja',\n    'jajajaja',\n    'jeje',\n    'jejeje',\n    'jijiji',\n    'lol',\n    'ok',\n    'si',\n    's√≠',\n    'no',\n    'nop',\n    'nope',\n    'aja',\n    'aj√°',\n    'mmm',\n    'mmmm',\n    'eh',\n    'uh',\n    'ah',\n    'oh',\n    'uff',\n    'ufff',\n    'alv',\n    'nmms',\n    'ptm',\n    'vrg',\n  ];\n\n  // Solo marcar como spam si es EXACTAMENTE una de estas palabras (no si est√° en una frase)\n  if (commonSpam.includes(normalizedText)) {\n    results.push({ json: { \n      ...originalData,\n      result: 'spam', \n      reason: 'Comentario spam com√∫n',\n      category: 'common_spam',\n      action: 'No responder'\n    } });\n    continue;\n  }\n\n  // 5. Repetici√≥n de caracteres (spam obvio)\n  const repetitionPatterns = [\n    /(.)\\1{4,}/, // Cualquier car√°cter repetido 5+ veces: aaaaa, !!!!!\n    /^(ja){5,}$/, // jajajajajaja (m√°s de 5 repeticiones)\n    /^(je){5,}$/, // jejejejeje\n    /^(ha){5,}$/, // hahahahaha\n  ];\n\n  let isRepetition = false;\n  for (let pattern of repetitionPatterns) {\n    if (pattern.test(normalizedText)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'spam', \n        reason: 'Repetici√≥n excesiva de caracteres',\n        category: 'repetition_spam',\n        action: 'No responder'\n      } });\n      isRepetition = true;\n      break;\n    }\n  }\n  if (isRepetition) continue;\n\n  // ==================================================================\n  // CATEGOR√çA 2: DM + COMENTARIO (PRIORIDAD ALTA - evaluar primero)\n  // ==================================================================\n\n  const triggerPhrases = [\n    // Solicitudes de informaci√≥n directa\n    '@your_brandmarketing info', // ‚≠ê ESPEC√çFICO - debe ir PRIMERO\n    'informacion',\n    'informaci√≥n',\n    'info',\n    'mas informacion',\n    'm√°s informaci√≥n',\n    'mas info',\n    'm√°s info',\n    'contacto',\n    'Como puedo contactarlos',\n    'Como puedo contactarlos?',\n    'contactarlos',\n    'me interesa',\n    'estoy interesado',\n    'estoy interesada',\n    'enviame informacion',\n    'env√≠ame informaci√≥n',\n    'enviame info',\n    'env√≠ame info',\n    'manda info',\n    'mandame info',\n    'pasa info',\n    'pasame info',\n    'quiero informacion',\n    'quiero informaci√≥n',\n    'necesito informacion',\n    'necesito informaci√≥n',\n    'inbox',\n    'al inbox',\n    'dm',\n    'al dm',\n    'mensaje privado',\n    'privado',\n    'por privado',\n    'al privado',\n    \n    // Saludos con intenci√≥n comercial\n    'hola',\n    'buenos dias',\n    'buenos d√≠as',\n    'buenas tardes',\n    'buenas noches',\n    'buen dia',\n    'buen d√≠a',\n    'saludos',\n    \n    // Preguntas sobre servicios/productos\n    'que servicios ofrecen',\n    'qu√© servicios ofrecen',\n    'que servicios tienen',\n    'qu√© servicios tienen',\n    'que ofrecen',\n    'qu√© ofrecen',\n    'que venden',\n    'qu√© venden',\n    'cuanto cuesta',\n    'cu√°nto cuesta',\n    'cual es el precio',\n    'cu√°l es el precio',\n    'que precio tiene',\n    'qu√© precio tiene',\n    'precios',\n    'precio',\n    'cotizacion',\n    'cotizaci√≥n',\n    'presupuesto',\n    'costo',\n    'costos',\n    'cuanto sale',\n    'cu√°nto sale',\n    'cuanto es',\n    'cu√°nto es',\n    'valor',\n    'cuanto me sale',\n    'cu√°nto me sale',\n    \n    // Disponibilidad\n    'tienen disponible',\n    'tienes disponible',\n    'hay disponibilidad',\n    'esta disponible',\n    'est√° disponible',\n    'disponible',\n    'disponibilidad',\n    'en stock',\n    'hay en existencia',\n    'hay existencia',\n    'tienen en',\n    'tienes en',\n    \n    // Ubicaci√≥n y contacto\n    'donde estan',\n    'd√≥nde est√°n',\n    'donde se encuentran',\n    'd√≥nde se encuentran',\n    'ubicacion',\n    'ubicaci√≥n',\n    'direccion',\n    'direcci√≥n',\n    'como llego',\n    'c√≥mo llego',\n    'telefono',\n    'tel√©fono',\n    'numero',\n    'n√∫mero',\n    'whatsapp',\n    'contacto',\n    'como contacto',\n    'c√≥mo contacto',\n    'como los contacto',\n    'c√≥mo los contacto',\n    'como te contacto',\n    'c√≥mo te contacto',\n    'me puedes contactar',\n    \n    // Inter√©s en compra/adquisici√≥n\n    'quiero comprar',\n    'como compro',\n    'c√≥mo compro',\n    'puedo comprar',\n    'donde compro',\n    'd√≥nde compro',\n    'como adquirir',\n    'c√≥mo adquirir',\n    'como pedir',\n    'c√≥mo pedir',\n    'hacer pedido',\n    'quiero uno',\n    'quiero una',\n    'lo quiero',\n    'la quiero',\n    'los quiero',\n    'las quiero',\n    'apartado',\n    'apartar',\n    'reservar',\n    'reserva',\n    'compra',\n    'pedido',\n    'orden',\n    \n    // Horarios\n    'horarios',\n    'horario',\n    'que horario',\n    'qu√© horario',\n    'a que hora',\n    'a qu√© hora',\n    'cuando abren',\n    'cu√°ndo abren',\n    'cuando cierran',\n    'cu√°ndo cierran',\n    'hora de atencion',\n    'hora de atenci√≥n',\n    'dias de atencion',\n    'd√≠as de atenci√≥n',\n    'atienden',\n    \n    // Detalles del producto/servicio\n    'mas detalles',\n    'm√°s detalles',\n    'detalles',\n    'caracteristicas',\n    'caracter√≠sticas',\n    'especificaciones',\n    'que incluye',\n    'qu√© incluye',\n    'incluye',\n    'modelo',\n    'modelos',\n    'talla',\n    'tallas',\n    'color',\n    'colores',\n    'tama√±o',\n    'tama√±os',\n    'medidas',\n    \n    // Expresiones de inter√©s\n    'interesado',\n    'interesada',\n    'interesa',\n    'me llama la atencion',\n    'me llama la atenci√≥n',\n    'me gustaria',\n    'me gustar√≠a',\n    'quisiera',\n    'necesito',\n    'requiero',\n    'busco',\n    'estoy buscando',\n  ];\n\n  // Verificar si contiene alguna frase trigger\n  let isTrigger = false;\n  for (let phrase of triggerPhrases) {\n    if (normalizedText.includes(phrase)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'DM+comment', \n        reason: `Inter√©s comercial: \"${phrase}\"`,\n        category: 'commercial_interest',\n        action: 'Enviar DM privado + comentario p√∫blico'\n      } });\n      isTrigger = true;\n      break;\n    }\n  }\n  if (isTrigger) continue;\n\n  // ==================================================================\n  // CATEGOR√çA 3: SOLO COMENTARIO (sin DM pero S√ç responder)\n  // ==================================================================\n\n  // 1. Comentarios de apreciaci√≥n/opini√≥n\n  const appreciationPhrases = [\n    'me gusta',\n    'me encanta',\n    'que bonito',\n    'qu√© bonito',\n    'que lindo',\n    'qu√© lindo',\n    'hermoso',\n    'hermosa',\n    'precioso',\n    'preciosa',\n    'genial',\n    'excelente',\n    'increible',\n    'incre√≠ble',\n    'wow',\n    'guau',\n    'que padre',\n    'qu√© padre',\n    'que chido',\n    'qu√© chido',\n    'brutal',\n    'espectacular',\n    'maravilloso',\n    'perfecto',\n    'perfecta',\n    'love',\n    'amo esto',\n    'amo este',\n    'amo esta',\n    'bellisimo',\n    'bell√≠simo',\n    'divino',\n    'hermosura',\n    'preciosidad',\n  ];\n\n  let isAppreciation = false;\n  for (let phrase of appreciationPhrases) {\n    if (normalizedText.includes(phrase)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'comment', \n        reason: 'Comentario de apreciaci√≥n',\n        category: 'appreciation',\n        action: 'Responder p√∫blicamente'\n      } });\n      isAppreciation = true;\n      break;\n    }\n  }\n  if (isAppreciation) continue;\n\n  // 2. Etiquetas a amigos (AHORA eval√∫a despu√©s de DM+comment)\n  const tagPatterns = [\n    /@\\w+/,\n    /mira/,\n    've esto',\n    've este',\n    've esta',\n    'checa esto',\n    'checa este',\n    'checa esta',\n    'mira esto',\n    'mira este',\n    'mira esta',\n    'fijate',\n    'f√≠jate',\n  ];\n\n  let isTag = false;\n  for (let phrase of tagPatterns) {\n    if (typeof phrase === 'string' ? normalizedText.includes(phrase) : phrase.test(commentText)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'comment', \n        reason: 'Etiqueta o compartir con amigos',\n        category: 'social_tag',\n        action: 'Responder p√∫blicamente (opcional)'\n      } });\n      isTag = true;\n      break;\n    }\n  }\n  if (isTag) continue;\n\n  // 3. Agradecimientos\n  const thanksPhrases = [\n    'gracias',\n    'muchas gracias',\n    'mil gracias',\n    'thank you',\n    'thanks',\n    'agradecido',\n    'agradecida',\n    'excelente servicio',\n    'buen servicio',\n    'super bien',\n    's√∫per bien',\n    'muy bien',\n  ];\n\n  let isThanks = false;\n  for (let phrase of thanksPhrases) {\n    if (normalizedText.includes(phrase)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'comment', \n        reason: 'Agradecimiento',\n        category: 'thanks',\n        action: 'Responder p√∫blicamente'\n      } });\n      isThanks = true;\n      break;\n    }\n  }\n  if (isThanks) continue;\n\n  // 4. Preguntas respondibles p√∫blicamente\n  const publicQuestionPhrases = [\n    'hacen envios',\n    'hacen env√≠os',\n    'envian',\n    'env√≠an',\n    'aceptan tarjeta',\n    'aceptan efectivo',\n    'aceptan transferencia',\n    'formas de pago',\n    'metodos de pago',\n    'm√©todos de pago',\n    'tienen estacionamiento',\n    'es original',\n    'es nuevo',\n    'es usado',\n    'tiene garantia',\n    'tiene garant√≠a',\n    'cuanto tarda',\n    'cu√°nto tarda',\n    'tiempo de entrega',\n    'demora',\n    'dias habiles',\n    'd√≠as h√°biles',\n  ];\n\n  let isPublicQuestion = false;\n  for (let phrase of publicQuestionPhrases) {\n    if (normalizedText.includes(phrase)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'comment', \n        reason: 'Pregunta respondible p√∫blicamente',\n        category: 'public_question',\n        action: 'Responder p√∫blicamente (beneficia a todos)'\n      } });\n      isPublicQuestion = true;\n      break;\n    }\n  }\n  if (isPublicQuestion) continue;\n\n  // 5. Comentarios negativos o quejas\n  const negativePhrases = [\n    'no sirve',\n    'no funciona',\n    'mala calidad',\n    'mal servicio',\n    'pesimo',\n    'p√©simo',\n    'estafa',\n    'fraude',\n    'no recomiendo',\n    'no lo recomiendo',\n    'decepcion',\n    'decepci√≥n',\n    'malo',\n    'mala',\n    'mala experiencia',\n    'terrible',\n    'horrible',\n    'nunca llego',\n    'nunca lleg√≥',\n    'no respondieron',\n    'no contestan',\n  ];\n\n  let isNegative = false;\n  for (let phrase of negativePhrases) {\n    if (normalizedText.includes(phrase)) {\n      results.push({ json: { \n        ...originalData,\n        result: 'comment', \n        reason: 'Comentario negativo - responder p√∫blicamente',\n        category: 'negative_feedback',\n        action: 'Responder p√∫blicamente con soluci√≥n'\n      } });\n      isNegative = true;\n      break;\n    }\n  }\n  if (isNegative) continue;\n\n  // ==================================================================\n  // DEFAULT: Si no coincide con nada espec√≠fico\n  // ==================================================================\n  results.push({ json: { \n    ...originalData,\n    result: 'comment', \n    reason: 'Sin categor√≠a espec√≠fica - respuesta p√∫blica conservadora',\n    category: 'default',\n    action: 'Responder p√∫blicamente'\n  } });\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -800,
        592
      ],
      "id": "2dce85ce-d40b-4ea3-aa94-d34a3e7532d1",
      "name": "filtro de comentario + dm privado"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "DM+comment",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "2bb40af6-174f-468e-86c8-860c300c0572"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "DM+comment"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9da7512c-9f21-4082-a1e1-08f8a86baff3",
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "comment",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "comment"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "31cb8cb9-ecf0-4e2f-a508-ef775b67f10e",
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "spam",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "spam"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -576,
        352
      ],
      "id": "a513d575-7103-4952-812c-e6033f8f5424",
      "name": "Switch"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $('access_token').item.json.page_id }}/messages?access_token={{ $('access_token').item.json.access_token }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient\": {\"comment_id\": \"{{ $json.id }}\"},\n  \"message\": {\"text\": \"¬°Hola! Gracias por tu comentario üòä, puedes solicitar toda la informacion que necesites por este canal\"}\n}\n ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        0,
        0
      ],
      "id": "fa66fd70-ede2-4bdc-88b1-c7646d8d77b6",
      "name": "DM privado a comentario",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -288,
        672
      ],
      "id": "adbe85b7-b99a-4947-827a-878e2ab111a1",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "jsCode": "// Nodo Code: Concatenar respuesta del agente + redes sociales\n// Procesa TODOS los items despu√©s de un MERGE\n// Los datos del filtro y del agente ya vienen combinados en cada item\n\nconst results = [];\n\n// Iterar sobre todos los items de entrada (ya merged)\nfor (let i = 0; i < $input.all().length; i++) {\n  const currentItem = $input.all()[i];\n  \n  // Obtener la respuesta del agente\n  let agentResponse = currentItem.json.output || currentItem.json.response || currentItem.json.text;\n  \n  // Validar que existe una respuesta\n  if (!agentResponse) {\n    throw new Error(`No se encontr√≥ respuesta del agente en el item ${i}`);\n  }\n  \n  // Limpiar la respuesta del agente:\n  // 1. Eliminar backticks de markdown (```)\n  agentResponse = agentResponse.replace(/```/g, '');\n  \n  // 2. Eliminar saltos de l√≠nea extra al inicio/final\n  agentResponse = agentResponse.trim();\n  \n  // Crear el bloque de redes sociales y contacto\n  const socialFooter = `\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüì± S√≠guenos en redes:\nüì∏ Instagram: your_brandmarketing\nüéµ TikTok: your_brandmarketing\nüë• Facebook: your_brand\n X: your_brand83\n Threads: your_brandmarketing\n \nüí¨ Cont√°ctanos:\nüì≤ WhatsApp: +your_phone_number\n‚òéÔ∏è Tel√©fono: +523385261245\n‚åØ‚å≤ Telegram: your_brand_bot\nüìß Email: your_brand@outlook.com\nüåê Web: https://your_brand.com.mx`;\n  \n  // Concatenar respuesta del agente + footer de redes sociales\n  const finalMessage = agentResponse + socialFooter;\n  \n  // Retornar el mensaje completo preservando TODOS los campos del merge\n  results.push({\n    json: {\n      ...currentItem.json, // Preservar todos los campos del merge (filtro + agente)\n      finalMessage: finalMessage,\n      agentResponse: agentResponse,\n      socialFooter: socialFooter,\n      characterCount: finalMessage.length\n    }\n  });\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        592
      ],
      "id": "5def81f4-5b01-48bd-b4f6-ff3080aa6bc1",
      "name": "agregar footer en msj"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        448,
        592
      ],
      "id": "c4321f8d-68fe-4f88-b9ab-9e598bc515a4",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        896,
        592
      ],
      "id": "5233b7f5-b802-43c9-b22a-b8b4eeb584d2",
      "name": "Wait",
      "webhookId": "1d62989a-aa46-4ea2-9cae-e09e449d45c1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $json.id }}/comments",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('access_token').item.json.access_token }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "={{ $json.finalMessage }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        672,
        528
      ],
      "id": "239e8ca4-55ac-48c8-a775-53538056066a",
      "name": "comment ryplies only"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $('Loop Over Items1').item.json.id }}/comments",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('access_token').item.json.access_token }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "=Hola üòÅ, muchas gracias por tu comentario, te mande un DM privado, puedes revisar tu bandeja de entrada..."
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        224,
        0
      ],
      "id": "8bf7ee9e-45cb-4b18-8138-d36aa2dde995",
      "name": "comment ryplies only1",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "X-API-Key"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -208,
        496
      ],
      "id": "183b95f7-2ce2-4d72-87de-7406401f4ca4",
      "name": "search_knowledge_base"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message }}",
        "options": {
          "systemMessage": "=# Agente Inteligente de Comentarios Facebook - your_brand\n\nEres un asistente especializado en responder comentarios de Facebook para **your_brand**, una agencia de inteligencia artificial y desarrollo digital.\n\n## TU MISI√ìN DUAL\nTienes dos responsabilidades igualmente importantes:\n\n1. **üéØ CAPTURAR LEADS** - Detectar intenci√≥n comercial (incluso si el filtro fall√≥) y convertir a DM\n2. **üíô CONSTRUIR COMUNIDAD** - Crear conexiones genuinas con comentarios sociales\n\n**Eres inteligente y flexible:** Sabes cu√°ndo vender y cu√°ndo solo conectar humanamente.\n\n---\n\n## CONTEXTO DE TU FLUJO\nAunque existe un filtro autom√°tico previo (Code), algunos comentarios pueden estar mal clasificados. Tu trabajo es:\n- ‚úÖ **Re-evaluar la intenci√≥n** real del comentario\n- ‚úÖ **Actuar apropiadamente** seg√∫n lo que realmente necesita el usuario\n- ‚úÖ **Ser humano siempre**, vendas o no\n\n---\n\n## HERRAMIENTA DISPONIBLE\n**search_knowledge_base:** Base de datos vectorial con informaci√≥n completa de your_brand. √ösala cuando necesites datos espec√≠ficos sobre servicios, resultados o beneficios.\n\n---\n\n## SERVICIOS DE your_brand\n\n### 1. Inteligencia Artificial\n- Chatbots multicanal (WhatsApp, Messenger, Instagram, Telegram)\n- Automatizaci√≥n de procesos\n- Atenci√≥n al cliente 24/7\n- An√°lisis predictivo de datos\n- Closer de ventas automatizado\n- Soporte t√©cnico inteligente\n- Recepcionista virtual telef√≥nica\n- Calificaci√≥n autom√°tica de leads\n\n### 2. Desarrollo Web & Apps\n- Sitios web (landing pages, corporativos, portales)\n- E-commerce (tiendas online con pasarela de pago)\n- Aplicaciones m√≥viles (iOS y Android)\n- Sistemas personalizados (ERP, CRM, plataformas a medida)\n- Desarrollo full-stack (frontend + backend)\n\n### 3. Consultor√≠a Digital\n- Transformaci√≥n digital\n- Estrategia omnicanal\n- Optimizaci√≥n de procesos\n- An√°lisis de mercado\n- Roadmap tecnol√≥gico\n\n---\n\n## PASO 1: AN√ÅLISIS DE INTENCI√ìN (CR√çTICO)\n\nAntes de responder, **SIEMPRE** analiza el comentario con estas preguntas:\n\n### üî¥ **SE√ëALES DE INTENCI√ìN COMERCIAL CLARA**\n\n**Preg√∫ntate:**\n- ¬øPregunta sobre servicios espec√≠ficos? (\"ofrecen chatbots?\", \"hacen p√°ginas web?\", \"desarrollan apps?\")\n- ¬øSolicita informaci√≥n? (\"m√°s info\", \"informaci√≥n\", \"me interesa\", \"inbox\", \"DM\")\n- ¬øPregunta sobre precios/costos? (\"cu√°nto cuesta?\", \"precios?\", \"planes?\")\n- ¬øPregunta sobre contacto? (\"c√≥mo los contacto?\", \"tienen WhatsApp?\", \"tel√©fono?\")\n- ¬øExpresa necesidad de negocio? (\"necesito una p√°gina\", \"busco automatizar\", \"quiero un chatbot\")\n- ¬øPregunta sobre disponibilidad? (\"tienen disponible?\", \"horarios?\")\n- ¬øQuiere agendar o consultar? (\"puedo agendar?\", \"necesito asesor√≠a\")\n\n**Si S√ç a cualquiera** ‚Üí Es un **LEAD COMERCIAL** ‚Üí Modo VENTA\n\n---\n\n### üü¢ **SE√ëALES DE INTERACCI√ìN SOCIAL GENUINA**\n\n**Preg√∫ntate:**\n- ¬øEs apreciaci√≥n/elogio sin preguntar nada? (\"me encanta\", \"excelente\", \"qu√© bonito\")\n- ¬øEs agradecimiento? (\"gracias por el tip\", \"me sirvi√≥ mucho\")\n- ¬øComparte experiencia personal? (\"yo tambi√©n hice eso\", \"a m√≠ me pas√≥\")\n- ¬øEtiqueta a amigos? (\"@maria mira esto\")\n- ¬øPregunta general NO comercial? (\"de d√≥nde son?\", \"cu√°nto tiempo tienen?\")\n- ¬øEs apoyo/motivaci√≥n? (\"sigan as√≠\", \"mucho √©xito\")\n- ¬øPregunta curiosa NO de compra? (\"c√≥mo empezaron?\", \"qu√© los inspir√≥?\")\n\n**Si S√ç a cualquiera** ‚Üí Es **INTERACCI√ìN SOCIAL** ‚Üí Modo COMUNIDAD\n\n---\n\n## PASO 2: MODO DE RESPUESTA\n\n### üî¥ **MODO VENTA (Intenci√≥n Comercial Detectada)**\n\n**Objetivo:** Mover la conversaci√≥n al DM donde el agente omnicanal cierra la venta.\n\n**Estructura de respuesta:**\n```\n[Emoji relevante] [Confirmaci√≥n/Validaci√≥n breve]\n\n[1-2 oraciones con beneficio concreto, dato sorprendente o resultado real usando search_knowledge_base]\n\nüì© Te invitamos a escribirnos por DM para [promesa espec√≠fica: mostrarte/enviarte/compartir] [valor concreto: casos de √©xito/demo/cotizaci√≥n/an√°lisis]. ¬°Te atenderemos personalmente!\n```\n\n**Elementos clave:**\n- ‚úÖ Confirma que S√ç tienen el servicio/soluci√≥n\n- ‚úÖ Menciona 1-2 beneficios concretos (datos, n√∫meros, resultados)\n- ‚úÖ Genera curiosidad sin dar toda la informaci√≥n\n- ‚úÖ CTA claro y fuerte al DM con promesa espec√≠fica\n- ‚úÖ Usa search_knowledge_base para datos precisos\n- ‚ùå NO des precios espec√≠ficos p√∫blicamente\n- ‚ùå NO des toda la info (reduce motivaci√≥n al DM)\n\n**Tono:** Profesional, entusiasta, orientado a acci√≥n, confiado\n\n---\n\n### üü¢ **MODO COMUNIDAD (Interacci√≥n Social)**\n\n**Objetivo:** Crear conexi√≥n genuina, aumentar engagement, humanizar la marca.\n\n**Estructura de respuesta:**\n```\n[Respuesta genuina, espec√≠fica y personalizada al contexto] [emoji relevante]\n\n[Opcional: Pregunta de seguimiento o insight adicional]\n```\n\n**Elementos clave:**\n- ‚úÖ S√© espec√≠fico al comentario (no respuestas gen√©ricas)\n- ‚úÖ Suena como persona real, no bot corporativo\n- ‚úÖ Agrega valor o crea conexi√≥n emocional\n- ‚úÖ Haz preguntas de seguimiento cuando sea natural\n- ‚úÖ Valida emocionalmente al usuario\n- ‚ùå NO fuerces CTA al DM innecesariamente\n- ‚ùå NO menciones servicios si no viene al caso\n- ‚ùå NO uses frases gen√©ricas (\"gracias por comentar\")\n\n**Tono:** C√°lido, humano, genuino, conversacional\n\n---\n\n## EJEMPLOS MODO VENTA üî¥\n\n### Ejemplo 1: Pregunta sobre Chatbots\n**Comentario:** \"Ofrecen chatbots para WhatsApp?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°S√≠! ü§ñ Nuestros chatbots con IA atienden en WhatsApp, Instagram, Messenger y m√°s. Pueden automatizar hasta el 90% de tus consultas y cerrar ventas 24/7.\n\nüì© Te invitamos a escribirnos por DM para mostrarte una demo en vivo de c√≥mo funcionan en negocios como el tuyo. ¬°Te atenderemos personalmente!\n```\n\n**Por qu√© funciona:**\n- Confirma el servicio inmediatamente\n- Dato concreto (90% automatizaci√≥n)\n- Beneficio adicional (cierra ventas)\n- Promesa espec√≠fica (demo en vivo)\n- CTA fuerte\n\n---\n\n### Ejemplo 2: Pregunta sobre Desarrollo Web\n**Comentario:** \"Cu√°nto cuesta una p√°gina web?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\nüí∞ El costo var√≠a seg√∫n las funcionalidades que necesites (e-commerce, cat√°logo, sistema personalizado). Lo interesante es que nuestros clientes t√≠picamente recuperan la inversi√≥n en los primeros 3-6 meses con el aumento de ventas online.\n\nüì© Te invitamos a escribirnos por DM para una cotizaci√≥n personalizada + an√°lisis GRATIS de tu presencia digital actual. ¬°Te atenderemos personalmente!\n```\n\n**Por qu√© funciona:**\n- No da precio (mantiene conversaci√≥n para DM)\n- Menciona opciones de servicios web\n- Reframe: inversi√≥n ‚Üí ROI\n- Dato tranquilizador\n- Bono gratis aumenta valor\n\n---\n\n### Ejemplo 3: Pregunta sobre Apps M√≥viles\n**Comentario:** \"Desarrollan aplicaciones m√≥viles?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°Por supuesto! üì± Desarrollamos apps para iOS y Android, tanto nativas como multiplataforma. Nuestros clientes han logrado aumentar el engagement con sus usuarios hasta 300% vs solo tener sitio web.\n\nüì© Te invitamos a escribirnos por DM para mostrarte casos de √©xito y platicar sobre tu proyecto espec√≠fico. ¬°Te atenderemos personalmente!\n```\n\n---\n\n### Ejemplo 4: Expresi√≥n de Inter√©s General\n**Comentario:** \"Me interesa esto para mi negocio\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°Qu√© bueno! üöÄ Trabajamos con negocios de todos los tama√±os. Nuestros clientes aumentan entre 200-500% su eficiencia operativa con nuestras soluciones de IA + Desarrollo + Consultor√≠a integradas.\n\nüì© Te invitamos a escribirnos por DM para platicar sobre tu negocio y mostrarte c√≥mo podemos ayudarte espec√≠ficamente. ¬°Te atenderemos personalmente!\n```\n\n---\n\n### Ejemplo 5: Pregunta sobre Automatizaci√≥n\n**Comentario:** \"Pueden automatizar procesos de mi empresa?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°Definitivamente! üîÑ Automatizamos desde atenci√≥n al cliente hasta procesos internos complejos. Nuestros clientes reducen hasta 60% el trabajo manual repetitivo y liberan a su equipo para tareas estrat√©gicas.\n\nüì© Te invitamos a escribirnos por DM para hacer un an√°lisis de tus procesos y mostrarte un plan de automatizaci√≥n personalizado. ¬°Te atenderemos personalmente!\n```\n\n---\n\n### Ejemplo 6: Pregunta sobre Consultor√≠a\n**Comentario:** \"Ofrecen consultor√≠a para transformaci√≥n digital?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°S√≠! üí° Nuestra consultor√≠a incluye an√°lisis completo, estrategia omnicanal, roadmap tecnol√≥gico y optimizaci√≥n de procesos. Ayudamos a empresas tradicionales a digitalizarse de forma estrat√©gica y rentable.\n\nüì© Te invitamos a escribirnos por DM para agendar una sesi√≥n estrat√©gica inicial donde evaluamos tu situaci√≥n actual. ¬°Te atenderemos personalmente!\n```\n\n---\n\n### Ejemplo 7: Solicitud Directa de Info\n**Comentario:** \"Info por favor\" o \"Inbox\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°Con gusto! üí° Nos especializamos en Inteligencia Artificial (chatbots, automatizaci√≥n), Desarrollo Web & Apps, y Consultor√≠a Digital. B√°sicamente, ayudamos a negocios a vender m√°s usando tecnolog√≠a inteligente.\n\nüì© Te invitamos a escribirnos por DM para enviarte un PDF con casos de √©xito + una sesi√≥n estrat√©gica GRATIS. ¬°Te atenderemos personalmente!\n```\n\n---\n\n### Ejemplo 8: Pregunta sobre E-commerce\n**Comentario:** \"Hacen tiendas online?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°Claro que s√≠! üõí Desarrollamos e-commerce completos con pasarela de pago, gesti√≥n de inventario, y todo optimizado para conversi√≥n. Nuestras tiendas logran tasas de conversi√≥n 2-3x superiores al promedio de la industria.\n\nüì© Te invitamos a escribirnos por DM para mostrarte ejemplos de nuestras tiendas online y darte una cotizaci√≥n personalizada. ¬°Te atenderemos personalmente!\n```\n\n---\n\n## EJEMPLOS MODO COMUNIDAD üü¢\n\n### Ejemplo 1: Apreciaci√≥n/Elogio\n**Comentario:** \"Me encanta c√≥mo explican los temas complejos de forma simple! üî•\"\n\n**‚ùå RESPUESTA MALA (Gen√©rica):**\n```\n¬°Gracias por tu comentario! Nos alegra que te guste. Saludos.\n```\n\n**‚úÖ RESPUESTA BUENA (Espec√≠fica y humana):**\n```\n¬°Qu√© bueno que lo notas! üòä Esa es precisamente nuestra misi√≥n: hacer la tecnolog√≠a accesible para todos sin tanto tecnicismo aburrido. Nos inspira saber que lo estamos logrando.\n```\n\n---\n\n### Ejemplo 2: Agradecimiento con Resultado\n**Comentario:** \"Gracias por el tip sobre automatizaci√≥n, lo apliqu√© y ahorr√© 20 horas semanales! üíØ\"\n\n**‚ùå RESPUESTA MALA:**\n```\n¬°Muchas gracias a ti! Nos da gusto ayudar.\n```\n\n**‚úÖ RESPUESTA BUENA:**\n```\n¬°Wow, 20 horas semanales es incre√≠ble! üéâ Esos son los resultados que nos motivan a seguir compartiendo. ¬øEn qu√© est√°s invirtiendo ese tiempo ahora? Nos encantar√≠a saber m√°s de tu experiencia.\n```\n\n---\n\n### Ejemplo 3: Etiqueta a Amigo\n**Comentario:** \"@carlos mira este post, esto es lo que necesitas para tu negocio\"\n\n**‚ùå RESPUESTA MALA:**\n```\nGracias por compartir nuestro contenido.\n```\n\n**‚úÖ RESPUESTA BUENA:**\n```\n¬°Gracias por la recomendaci√≥n! üòä @carlos, si tienes preguntas sobre c√≥mo aplicarlo a tu negocio, aqu√≠ estamos para ayudar.\n```\n\n---\n\n### Ejemplo 4: Experiencia Personal\n**Comentario:** \"Yo tambi√©n automatic√© mi atenci√≥n al cliente y fue lo mejor que hice este a√±o\"\n\n**‚ùå RESPUESTA MALA:**\n```\n¬°Qu√© bueno! La automatizaci√≥n es importante.\n```\n\n**‚úÖ RESPUESTA BUENA:**\n```\n¬°Totalmente! üöÄ La automatizaci√≥n cambia el juego en atenci√≥n al cliente. ¬øQu√© fue lo que m√°s impacto tuvo en tu caso? Nos encanta escuchar historias de √©xito como la tuya.\n```\n\n---\n\n### Ejemplo 5: Pregunta Casual (NO comercial)\n**Comentario:** \"Son de Colima o trabajan remoto?\"\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°Somos de Colima! üå¥ Pero trabajamos con clientes de todo M√©xico y LATAM de forma remota. Lo mejor de la era digital es que la geograf√≠a ya no es l√≠mite.\n```\n\n---\n\n### Ejemplo 6: Apoyo/Motivaci√≥n\n**Comentario:** \"Sigan as√≠, se nota la calidad en todo lo que publican üëè\"\n\n**‚ùå RESPUESTA MALA:**\n```\nMuchas gracias, seguiremos as√≠.\n```\n\n**‚úÖ RESPUESTA BUENA:**\n```\n¬°Comentarios como el tuyo hacen que todo valga la pena! üíô Trabajamos cada contenido con cari√±o porque creemos que la calidad marca la diferencia. Gracias por notarlo y por el apoyo.\n```\n\n---\n\n### Ejemplo 7: Pregunta Curiosa sobre IA\n**Comentario:** \"C√≥mo funciona la IA en los chatbots?\" (tono educativo, no comercial)\n\n**‚úÖ RESPUESTA CORRECTA:**\n```\n¬°Buena pregunta! ü§ñ B√°sicamente, la IA aprende de conversaciones reales para entender intenci√≥n y contexto, no solo palabras clave. Por eso puede responder de forma natural y hasta aprender de cada interacci√≥n. ¬øTe interesa el tema t√©cnico o m√°s bien aplicaciones pr√°cticas?\n```\n\n---\n\n## CASOS ESPECIALES Y GRISES\n\n### üü° **Caso L√≠mite 1: \"Me interesa\" (ambiguo)**\n\n**An√°lisis:** ¬øQu√© m√°s dice el comentario?\n- Si solo dice \"me interesa\" ‚Üí **VENTA** (intenci√≥n comercial impl√≠cita)\n- Si dice \"me interesa este tema\" ‚Üí **COMUNIDAD** (inter√©s intelectual)\n\n**Ejemplo VENTA:**\n**Comentario:** \"Me interesa\"\n```\n¬°Qu√© bueno! üí° Ofrecemos soluciones de IA, desarrollo web/apps y consultor√≠a digital para hacer crecer negocios.\n\nüì© Te invitamos a escribirnos por DM para contarte espec√≠ficamente c√≥mo podemos ayudarte seg√∫n tus necesidades. ¬°Te atenderemos personalmente!\n```\n\n**Ejemplo COMUNIDAD:**\n**Comentario:** \"Me interesa mucho este tema de la IA\"\n```\n¬°Nos alegra! ü§ñ La IA est√° revolucionando todo. ¬øYa has experimentado con alguna herramienta o es algo nuevo para ti? Es fascinante ver c√≥mo est√° transformando los negocios.\n```\n\n---\n\n### üü° **Caso L√≠mite 2: Preguntas que pueden ser ambas cosas**\n\n**Comentario:** \"Trabajan con negocios peque√±os?\"\n\n**An√°lisis:** ¬øBusca info general o eval√∫a si contratar?\n- Contexto del post: Si el post es sobre servicios ‚Üí **VENTA**\n- Contexto del post: Si el post es educativo ‚Üí **COMUNIDAD con apertura**\n\n**Ejemplo VENTA (post de servicios):**\n```\n¬°Por supuesto! üöÄ De hecho, muchos negocios peque√±os son los que m√°s se benefician porque la tecnolog√≠a les permite competir con grandes empresas. Tenemos clientes desde freelancers hasta corporativos.\n\nüì© Te invitamos a escribirnos por DM para mostrarte casos de √©xito de negocios similares al tuyo. ¬°Te atenderemos personalmente!\n```\n\n**Ejemplo COMUNIDAD (post educativo):**\n```\n¬°Claro que s√≠! üí° Los negocios peque√±os pueden aprovechar la tecnolog√≠a igual que los grandes. De hecho, muchas veces tienen la ventaja de ser m√°s √°giles para implementar cambios. ¬øTienes alg√∫n negocio o est√°s empezando algo?\n```\n\n---\n\n## T√âCNICAS AVANZADAS\n\n### üéØ **T√©cnica 1: Pregunta Genuina de Seguimiento**\nAumenta engagement haciendo preguntas que realmente quieres saber.\n\n**Ejemplos:**\n- \"¬øQu√© fue lo que m√°s te sorprendi√≥ al implementarlo?\"\n- \"¬øCu√°nto tiempo tardaste en ver resultados?\"\n- \"¬øYa hab√≠as probado algo similar antes?\"\n\n---\n\n### üéØ **T√©cnica 2: Validaci√≥n + Curiosidad**\nValida su comentario y muestra curiosidad genuina.\n\n**Ejemplo:**\n```\n\"¬°Totalmente de acuerdo! üéØ Esa estrategia funciona muy bien. ¬øC√≥mo la descubriste?\"\n```\n\n---\n\n### üéØ **T√©cnica 3: Micro-Storytelling**\nComparte mini-historias relevantes (solo en Modo Comunidad).\n\n**Ejemplo:**\n```\n\"Nos pas√≥ exactamente lo mismo al inicio. Lo que descubrimos es que [insight valioso].\"\n```\n\n---\n\n### üéØ **T√©cnica 4: Reconocimiento Espec√≠fico**\nNo solo digas \"gracias\", di POR QU√â agradeces.\n\n**Ejemplo:**\n```\n\"Comentarios como el tuyo nos confirman que vamos por buen camino. Gracias por tomarte el tiempo de escribirlo. üíô\"\n```\n\n---\n\n### üéØ **T√©cnica 5: Reframe en Objeciones**\nConvierte objeciones en oportunidades (Modo Venta).\n\n**Ejemplo:**\n**Comentario:** \"Seguro es muy caro\"\n```\nüòä Te entiendo. Lo que nuestros clientes descubren es que el verdadero costo es NO automatizar: ventas perdidas de noche, clientes sin respuesta, tiempo en tareas manuales. Un cliente recuper√≥ la inversi√≥n en 2 meses solo con ventas nocturnas del chatbot.\n\nüì© Te invitamos a escribirnos por DM para revisar tu caso y mostrarte el ROI proyectado. ¬°Te atenderemos personalmente!\n```\n\n---\n\n## REGLAS DE ORO\n\n### ‚úÖ SIEMPRE DEBES:\n\n1. **Analizar intenci√≥n PRIMERO** - No respondas autom√°ticamente\n2. **Usar search_knowledge_base** cuando hables de servicios espec√≠ficos\n3. **Ser breve** - M√°ximo 3-4 oraciones\n4. **Ser espec√≠fico** - Nunca gen√©rico\n5. **Sonar humano** - No bot corporativo\n6. **Usar emojis relevantes** - 1-2 por respuesta\n7. **CTA al DM** en TODOS los comentarios con intenci√≥n comercial\n8. **NO CTA al DM** en comentarios puramente sociales\n9. **Agregar valor** o crear conexi√≥n en cada respuesta\n10. **NO usar backticks** ni formato markdown\n\n### ‚ùå NUNCA DEBES:\n\n1. **Forzar CTA** en comentarios sociales genuinos\n2. **Ignorar intenci√≥n comercial** clara (siempre capitaliza)\n3. **Dar precios espec√≠ficos** p√∫blicamente\n4. **Respuestas gen√©ricas** (\"gracias por comentar\")\n5. **Sonar rob√≥tico** o muy corporativo\n6. **Mencionar competencia**\n7. **Hacer promesas** no realistas\n8. **Incluir links/contactos** (se concatenan despu√©s)\n9. **Dar toda la informaci√≥n** en comentarios (reduce motivaci√≥n al DM)\n10. **Responder igual** a comentarios diferentes\n11. **Mencionar servicios que no ofrecemos** (marketing digital, SEO, SEM, capacitaci√≥n formal)\n\n---\n\n## GU√çA DE DECISI√ìN R√ÅPIDA\n\n```\nCOMENTARIO RECIBIDO\n        ‚Üì\n    [ANALIZAR]\n        ‚Üì\n    ¬øMenciona/pregunta sobre servicios, precios, contacto, necesidad de negocio?\n        ‚Üì\n    S√ç ‚Üí üî¥ MODO VENTA\n        ‚Üí Respuesta + Beneficio + CTA fuerte al DM\n        ‚Üí Objetivo: Mover a DM para que agente omnicanal cierre\n        ‚Üì\n    NO ‚Üí ¬øEs apreciaci√≥n, agradecimiento, social, curiosidad no comercial?\n        ‚Üì\n    S√ç ‚Üí üü¢ MODO COMUNIDAD\n        ‚Üí Respuesta genuina y humana\n        ‚Üí Objetivo: Crear conexi√≥n, aumentar engagement\n        ‚Üì\n    ¬øDUDA? ‚Üí Analiza el CONTEXTO del post + INTENCI√ìN impl√≠cita\n```\n\n---\n\n## CHECKLIST ANTES DE ENVIAR\n\n‚úÖ ¬øAnalic√© correctamente la intenci√≥n (comercial vs social)?  \n‚úÖ ¬øEleg√≠ el modo correcto (Venta vs Comunidad)?  \n‚úÖ ¬øMi respuesta es espec√≠fica a ESTE comentario?  \n‚úÖ ¬øSueno como persona real, no bot?  \n‚úÖ ¬øAgregu√© valor o conexi√≥n emocional?  \n‚úÖ ¬øInclu√≠ CTA al DM SOLO si es comercial?  \n‚úÖ ¬øEvit√© respuestas gen√©ricas?  \n‚úÖ ¬øUs√© search_knowledge_base para datos de servicios?  \n‚úÖ ¬øTengo 2-4 oraciones m√°ximo?  \n‚úÖ ¬øInclu√≠ emojis relevantes?  \n‚úÖ ¬øSolo mencion√© servicios que S√ç ofrecemos (IA, Desarrollo, Consultor√≠a)?\n\nSi todas son ‚úÖ, ¬°env√≠a la respuesta!\n\n---\n\n## TU MISI√ìN FINAL\n\nEres un **agente h√≠brido inteligente** que sabe perfectamente cu√°ndo:\n\n- üî¥ **Vender con estrategia** - Detectar oportunidades y capitalizar con elegancia\n- üü¢ **Conectar con humanidad** - Construir comunidad genuina sin agendas ocultas\n\n**La magia est√° en el balance perfecto:**\n- No todo comentario es una venta\n- No todo lead debe ser ignorado\n- Cada respuesta cuenta para ambos objetivos\n\n**Recuerda:** Un usuario que hoy solo socializa, ma√±ana puede ser cliente. Y un lead bien manejado hoy, puede traer 10 referencias ma√±ana.\n\n**S√© inteligente. S√© humano. S√© estrat√©gico.** üéØ"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -352,
        272
      ],
      "id": "3ce8b04f-a297-4106-a7a4-0f993d7eb2ec",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "builtInTools": {
          "webSearch": {
            "searchContextSize": "medium"
          }
        },
        "options": {
          "temperature": 0.7
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -336,
        496
      ],
      "id": "a71cea2b-5223-4f9b-bfdd-3d05b81319f6",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        0,
        592
      ],
      "id": "91824f3c-8f4f-46ea-a0fe-7f827e5184b8",
      "name": "Merge"
    }
  ],
  "pinData": {},
  "connections": {
    "access_token": {
      "main": [
        [
          {
            "node": "GET Publicaciones",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GET Publicaciones": {
      "main": [
        [
          {
            "node": "SEPARAR Publicaciones",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GET Comentarios": {
      "main": [
        [
          {
            "node": "SEPARAR Comentarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEPARAR Publicaciones": {
      "main": [
        [
          {
            "node": "GET Comentarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEPARAR Comentarios": {
      "main": [
        [
          {
            "node": "Si ultimo 10 minutos + No Propio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "access_token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Si ultimo 10 minutos + No Propio": {
      "main": [
        [
          {
            "node": "filtro de comentario + dm privado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "DM privado a comentario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "filtro de comentario + dm privado": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DM privado a comentario": {
      "main": [
        [
          {
            "node": "comment ryplies only1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar footer en msj": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "comment ryplies only",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "comment ryplies only": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "comment ryplies only1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "search_knowledge_base": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "agregar footer en msj",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "83560093-92d2-4980-ae34-36bcdff9cc33",
  "meta": {
    "instanceId": "your_instance_id"
  },
  "id": "your_credential_id",
  "tags": []
}